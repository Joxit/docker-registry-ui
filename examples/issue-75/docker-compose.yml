version: '2.0'
services:
  registry:
    image: registry:2.7
    volumes:
      - ./data/registry:/var/lib/registry:rw
      - ./conf/registry/config.yml:/etc/docker/registry/config.yml:ro
    depends_on:
      - s3-server
    network_mode: host

  ui:
    image: joxit/docker-registry-ui:latest
    ports:
      - 80:80
    environment:
      - REGISTRY_URL=http://localhost:5000
      - DELETE_IMAGES=true
      - SINGLE_REGISTRY=true
    depends_on:
      - registry
    network_mode: host

  s3-server:
    image: minio/minio:RELEASE.2019-04-09T01-22-30Z
    volumes:
      - ./data/s3-server/s3-server-cmd:/bin/s3-server-cmd:ro
    environment:
      - MINIO_ACCESS_KEY=accessKey1
      - MINIO_SECRET_KEY=verySecretKey1
      - MINIO_REGION=us-east-1
    network_mode: host
    entrypoint: /bin/s3-server-cmd
